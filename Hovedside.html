<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hovedsiden — Watch (Strømmefunksjonell)</title>

  <link rel="icon" type="image/png" href="https://static.wixstatic.com/media/fd2fb2_39376e4ee55b460ab7a3ebbfcf35fef7~mv2.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
  /* --- Grunnleggende reset og farger beholdt --- */
  * { box-sizing: border-box; margin:0; padding:0 }
  html,body{ font-family: Arial, sans-serif; background:#091B1E; color:white; min-height:100vh; }

  /* --- Vertikal navigasjon (beholdt) --- */
  .vertical-nav{ width:70px; height:100vh; position:fixed; left:0; top:0; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:120 }
  .nav-icons-wrapper{ display:flex; flex-direction:column; gap:10px; align-items:center }
  .profilmeny img{ width:48px; height:48px; border-radius:50%; border:2px solid #fff; object-fit:cover }
  .nav-icon{ color:white; font-size:22px; padding:16px 0; text-align:center; width:100%; background:none; border:none; cursor:pointer; }
  .nav-icon:hover, .nav-icon.active{ color:#00FFCC }

  main{ margin-left:60px; padding:20px 10px 30px 10px }
  .content-wrapper{ width:92%; max-width:1800px; margin-left:auto; margin-right:4% }

  /* --- Top header --- */
  .top-header{ display:flex; align-items:center; width:100%; margin-bottom:20px }
  .top-header .watch-logo{ margin-left:auto; width:200px }
  .header-profil{ display:none }
  .top-header img.watch-logo{ width:200px }

  /* --- HERO (ny funksjonell versjon) --- */
  .hero-banner{ position:relative; height:420px; border-radius:12px; overflow:hidden; margin-bottom:30px; margin-left:16px; width:calc(100% - 16px); border:2px solid #00FFCC; background:#000 }
  .hero-media{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:block }
  .hero-overlay{ position:absolute; inset:0; background: linear-gradient(180deg, rgba(9,27,30,0) 0%, rgba(9,27,30,0.6) 60%, rgba(9,27,30,0.95) 100%); z-index:2 }
  .hero-content{ position:absolute; left:30px; bottom:24px; z-index:3; display:flex; gap:18px; align-items:center }
  .hero-content .film-logo{ width:320px; max-width:60vw }
  .hero-controls{ display:flex; gap:12px; align-items:center }
  .watch-button{ text-decoration:none; background:white; color:black; padding:10px 32px; border-radius:6px; font-weight:700 }
  .watch-button:hover{ background:#f2f2f2 }
  .btn-outline{ padding:10px 18px; border-radius:6px; border:2px solid rgba(255,255,255,0.12); background:transparent; color:white; cursor:pointer }
  .mute-toggle{ display:flex; gap:8px; align-items:center }

  /* overgang for video bytte */
  .hero-media, .hero-poster{ transition:opacity 0.9s ease; }
  .hero-poster{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover }

  /* --- Special hero med galleri (beholdt men litt oppgradert) --- */
  .special-hero-banner{ margin:30px 16px; width:calc(100% - 32px); border:2px solid #00FFCC; border-radius:12px; overflow:hidden; position:relative; height:350px }

  /* --- Gallerier (beholdt, med flere animasjoner) --- */
  .gallery-section{ margin-bottom:22px }
  .gallery-section h2{ font-size:18px; margin-bottom:12px; color:#00FFCC; padding-left:16px }
  .gallery-wrapper{ position:relative; display:flex; align-items:center }
  .fade-left, .fade-right{ position:absolute; top:0; bottom:0; width:70px; z-index:10; pointer-events:none; opacity:0; transition:opacity .25s }
  .fade-left{ left:0; background:linear-gradient(to right,#091B1E, rgba(9,27,30,0)) }
  .fade-right{ right:0; background:linear-gradient(to left,#091B1E, rgba(9,27,30,0)) }
  .gallery-wrapper:hover .scroll-button:not(.hidden), .gallery-wrapper:hover .fade-left, .gallery-wrapper:hover .fade-right{ opacity:1 }
  .scroll-button{ position:absolute; top:50%; transform:translateY(-50%); background:none; border:none; color:white; font-size:28px; cursor:pointer; z-index:11; opacity:0; pointer-events:none; transition:opacity .2s }
  .scroll-button.left{ left:0 }
  .scroll-button.right{ right:0 }
  .scroll-button.hidden{ display:none }
  .scroll-button:hover{ color:#00FFCC }

  .image-gallery{ display:flex; overflow-x:auto; gap:16px; padding:10px 16px; scroll-behavior:smooth }
  .image-gallery::-webkit-scrollbar{ display:none }
  .image-gallery a{ display:inline-block; border-radius:8px; overflow:hidden; position:relative }
  .image-gallery img{ width:220px; height:124px; object-fit:cover; display:block; transition:transform .25s }
  .image-gallery a:hover img{ transform:scale(1.05) }

  /* --- Hover preview-video i kortene --- */
  .card-preview{ position:relative; width:220px; height:124px; border-radius:8px; overflow:hidden; background:#000 }
  .card-preview img{ width:100%; height:100%; object-fit:cover }
  .card-preview video{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:0; transition:opacity .3s }
  .card-preview.show-video video{ opacity:1 }

  /* progress bar i 'Fortsett å se' */
  .image-with-progress{ position:relative; width:220px; height:124px; border-radius:8px; overflow:hidden }
  .progress-bar{ position:absolute; bottom:0; left:0; height:4px; width:100%; background:rgba(255,255,255,0.15) }
  .progress-bar::after{ content:''; position:absolute; left:0; top:0; height:100%; background:#00FFCC; width:var(--progress,0%) }

  /* --- Coming movies (beholdt) --- */
  .coming-movies-gallery{ display:flex; gap:22px; padding:20px 16px; overflow-x:auto }
  .coming-movie-item{ position:relative; flex:0 0 180px; height:300px; border-radius:8px; overflow:hidden; cursor:pointer; transition:all .6s; background:#000 }
  .coming-movie-item img.banner{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover }
  .coming-movie-item video{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:0; transition:opacity .6s }
  .coming-movie-item.show-video video{ opacity:1 }
  .coming-movie-item.expanded{ flex:0 0 440px; transform:scale(1.03) }
  .coming-movie-item .logo{ position:absolute; bottom:20px; left:50%; transform:translateX(-50%); max-height:50px; z-index:3 }
  .coming-movie-item .coming-movie-info{ position:absolute; bottom:15px; right:15px; font-size:14px; color:#fff; z-index:3; opacity:0; transition:opacity .4s; background:rgba(0,0,0,0.4); padding:6px 10px; border-radius:8px }
  .coming-movie-item.expanded .coming-movie-info{ opacity:1 }

  /* Top10 */
  .top10-gallery{ display:flex; gap:30px; padding:10px 16px; overflow-x:auto }
  .top10-item img{ width:150px; height:225px; border-radius:8px }
  .top10-number{ position:absolute; bottom:-10px; left:-15px; font-size:70px; font-weight:900; color:transparent; -webkit-text-stroke:3px #00FFCC }
  .top10-item:hover .top10-number{ color:#00FFCC; -webkit-text-stroke:0 }

  /* Footer */
  .footer{ margin-top:40px; padding:20px 10px; text-align:center; color:#515151; font-size:14px }
  .footer-links a{ color:#b1b1b1; margin:0 10px; text-decoration:none }
  .footer-copy{ font-size:13px; color:#00FFCC }

  /* Modal spiller */
  .modal{ position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:999; display:flex; align-items:center; justify-content:center; padding:20px }
  .modal.hidden{ display:none }
  .modal .player{ width:min(1200px,96%); height:min(680px,56%); background:#000; border-radius:10px; overflow:hidden; position:relative }
  .modal video{ width:100%; height:100%; object-fit:contain; background:#000 }
  .modal .close{ position:absolute; right:12px; top:12px; font-size:22px; color:white; background:rgba(255,255,255,0.06); padding:8px; border-radius:6px; cursor:pointer }
  .modal .controls{ position:absolute; left:12px; top:12px; display:flex; gap:8px; align-items:center }

  /* Responsivt (forenklet) */
  @media (max-width:768px){
    .vertical-nav{ width:100%; height:60px; flex-direction:row; justify-content:space-around; position:fixed; bottom:0; top:auto; background:rgba(9,27,30,0.95) }
    .top-header .watch-logo{ width:140px }
    .hero-banner{ height:300px }
    .hero-content .film-logo{ width:220px }
    .image-gallery img, .card-preview{ width:160px; height:90px }
  }

  </style>
</head>
<body>
  <div class="vertical-nav" id="verticalNav">
    <div class="nav-icons-wrapper">
      <div class="profilmeny" onclick="gåTilKonto()">
        <img id="menyProfilbilde" src="https://via.placeholder.com/100" alt="Min profil" />
      </div>
      <a href="Søk.html" class="nav-icon" title="Søk"><i class="fas fa-search"></i></a>
      <a href="Hovedside.html" class="nav-icon active" title="Hjem"><i class="fas fa-house"></i></a>
      <a href="Film.html" class="nav-icon" title="Film"><i class="fas fa-film"></i></a>
      <a href="Serier.html" class="nav-icon" title="Serier"><i class="fas fa-tv"></i></a>
      <a href="Min-Liste.html" class="nav-icon" title="Min liste"><i class="fas fa-bookmark"></i></a>
    </div>
  </div>

  <main>
    <div class="content-wrapper">
      <div class="top-header">
        <img class="watch-logo" src="https://static.wixstatic.com/media/fd2fb2_a4b2ace62dff4605a0387f46aad8a404~mv2.png" alt="Watch Logo" />
        <div class="profilmeny header-profil" onclick="gåTilKonto()">
          <img id="headerProfilbilde" src="https://via.placeholder.com/100" alt="Min profil" />
        </div>
      </div>

      <!-- HERO: video autoplay (muted) med fallback poster + kontroll for muting og åpning i modal -->
      <section class="hero-banner" id="heroBanner">
        <!-- Video element oppdateres av JS -->
        <video id="heroVideo" class="hero-media" playsinline muted loop preload="metadata" poster="" crossorigin="anonymous"></video>
        <img id="heroPoster" class="hero-poster" src="" alt="Banner" />
        <div class="hero-overlay"></div>
        <div class="hero-content">
          <img class="film-logo" id="heroLogo" src="" alt="Film Logo" />
          <div class="hero-controls">
            <a id="heroPlay" class="watch-button">Spill fra starten</a>
            <button id="heroTrailer" class="btn-outline">Se trailer</button>
            <div class="mute-toggle">
              <button id="muteBtn" class="btn-outline"><i class="fas fa-volume-mute"></i></button>
            </div>
          </div>
        </div>
      </section>

      <!-- Nye filmer -->
      <section class="gallery-section">
        <h2>Nye filmer på Watch</h2>
        <div class="gallery-wrapper">
          <div class="fade-left"></div>
          <button class="scroll-button left" onclick="scrollGallery(this, -1)">❮</button>
          <div class="image-gallery" id="nye-filmer-galleri"></div>
          <button class="scroll-button right" onclick="scrollGallery(this, 1)">❯</button>
          <div class="fade-right"></div>
        </div>
      </section>

      <!-- Fortsett å se -->
      <section class="gallery-section" id="fortsett-section" style="display:none;">
        <h2>Fortsett å se</h2>
        <div class="gallery-wrapper">
          <div class="fade-left"></div>
          <button class="scroll-button left" onclick="scrollGallery(this, -1)">❮</button>
          <div class="image-gallery" id="fortsett-galleri"></div>
          <button class="scroll-button right" onclick="scrollGallery(this, 1)">❯</button>
          <div class="fade-right"></div>
        </div>
      </section>

      <!-- Sjangere -->
      <section class="gallery-section">
        <h2>Sjangere</h2>
        <div class="gallery-wrapper">
          <div class="fade-left"></div>
          <button class="scroll-button left" onclick="scrollGallery(this, -1)">❮</button>
          <div class="image-gallery genre-gallery">
            <a href="sjanger.html?navn=barn">Barn / Familie <i class="fas fa-rocket"></i></a>
            <a href="sjanger.html?navn=komedie">Komedie <i class="fas fa-laugh"></i></a>
            <a href="sjanger.html?navn=skrekk">Skrekk <i class="fas fa-ghost"></i></a>
            <a href="sjanger.html?navn=drama">Drama <i class="fas fa-theater-masks"></i></a>
            <a href="sjanger.html?navn=romantikk">Romantikk <i class="fas fa-heart"></i></a>
            <a href="sjanger.html?navn=action">Action <i class="fas fa-bolt"></i></a>
          </div>
          <button class="scroll-button right" onclick="scrollGallery(this, 1)">❯</button>
          <div class="fade-right"></div>
        </div>
      </section>

      <!-- Topp 10 -->
      <section class="gallery-section">
        <h2>Topp 10 filmer nå</h2>
        <div class="gallery-wrapper">
          <div class="fade-left"></div>
          <button class="scroll-button left" onclick="scrollGallery(this, -1)">❮</button>
          <div class="top10-gallery" id="topp10-filmer-galleri"></div>
          <button class="scroll-button right" onclick="scrollGallery(this, 1)">❯</button>
          <div class="fade-right"></div>
        </div>
      </section>

      <!-- Serier -->
      <section class="gallery-section">
        <h2>Serier</h2>
        <div class="gallery-wrapper">
          <div class="fade-left"></div>
          <button class="scroll-button left" onclick="scrollGallery(this, -1)">❮</button>
          <div class="image-gallery" id="serier-galleri"></div>
          <button class="scroll-button right" onclick="scrollGallery(this, 1)">❯</button>
          <div class="fade-right"></div>
        </div>
      </section>

      <!-- Kommende filmer -->
      <section class="gallery-section">
        <h2>Kommende filmer</h2>
        <div class="gallery-wrapper">
          <div class="fade-left"></div>
          <button class="scroll-button left" onclick="scrollGallery(this, -1)">❮</button>
          <div class="coming-movies-gallery" id="kommer-snart-galleri"></div>
          <button class="scroll-button right" onclick="scrollGallery(this, 1)">❯</button>
          <div class="fade-right"></div>
        </div>
      </section>

      <!-- Barn -->
      <section class="gallery-section">
        <h2>Barn</h2>
        <div class="gallery-wrapper">
          <div class="fade-left"></div>
          <button class="scroll-button left" onclick="scrollGallery(this, -1)">❮</button>
          <div class="image-gallery" id="barn-galleri"></div>
          <button class="scroll-button right" onclick="scrollGallery(this, 1)">❯</button>
          <div class="fade-right"></div>
        </div>
      </section>

    </div>

    <footer class="footer">
      <div class="footer-links">
        <a href="kontakt.html">Kontakt oss</a>
        <a href="personvern.html">Personvern</a>
        <a href="vilkar.html">Vilkår for bruk</a>
        <a href="hjelp.html">Hjelp</a>
      </div>
      <div class="footer-copy">© 2025 Watch Nordic Grupe</div>
    </footer>
  </main>

  <!-- Modal for stor spiller/trailer -->
  <div id="playerModal" class="modal hidden" aria-hidden="true">
    <div class="player">
      <div class="controls">
        <button id="modalMute" class="btn-outline"><i class="fas fa-volume-mute"></i></button>
      </div>
      <button class="close" id="closeModal"><i class="fas fa-times"></i></button>
      <video id="modalVideo" controls playsinline crossorigin="anonymous"></video>
    </div>
  </div>

  <!-- Behold referanser til datafiler -->
  <script src="Filmdata.js"></script>
  <script src="Seriedata.js"></script>

  <script>
  // ==================== AUTENTISERING (beholdt) ====================
  const epost = localStorage.getItem("epost");
  const passord = localStorage.getItem("passord");
  if (!epost || !passord) { window.location.href = "Starts side.html" }
  window.addEventListener("storage", () => { if (!localStorage.getItem("epost")||!localStorage.getItem("passord")) window.location.href = "Starts side.html" })

  // Profilbilde
  const lagretBilde = localStorage.getItem("profilbilde");
  if (lagretBilde) { const menyProfil = document.getElementById("menyProfilbilde"); if (menyProfil) menyProfil.src = lagretBilde; const headerProfil = document.getElementById("headerProfilbilde"); if (headerProfil) headerProfil.src = lagretBilde }

  function gåTilKonto(){ window.location.href = "konto.html" }

  // -------------------- HERO: autoplay video med fade og modal --------------------
  const heroVideo = document.getElementById('heroVideo');
  const heroPoster = document.getElementById('heroPoster');
  const heroLogo = document.getElementById('heroLogo');
  const heroPlay = document.getElementById('heroPlay');
  const heroTrailerBtn = document.getElementById('heroTrailer');
  const muteBtn = document.getElementById('muteBtn');

  let heroList = []; // liste med filmkeys som kan vises
  let heroIndex = 0;
  let heroRotateInterval = null;

  function setupHeroRotation() {
    heroList = Object.keys(filmer).filter(key => filmer[key].trailer || filmer[key].banner || filmer[key].poster);
    if (heroList.length === 0) return;
    // start på en tilfeldig film
    heroIndex = Math.floor(Math.random() * heroList.length);
    showHeroAt(heroIndex);
    if (heroRotateInterval) clearInterval(heroRotateInterval);
    heroRotateInterval = setInterval(() => { heroIndex = (heroIndex + 1) % heroList.length; transitionHeroTo(heroIndex); }, 12000); // bytt hver 12s
  }

  function showHeroAt(index){
    const key = heroList[index];
    const film = filmer[key];
    // poster fallback
    heroPoster.src = film.banner || film.poster || '';
    heroPoster.alt = film.tittel || '';
    // logo
    if (film.logo) { heroLogo.src = film.logo; heroLogo.style.display = 'block' } else { heroLogo.style.display = 'none' }
    // video
    if (film.trailer) {
      heroVideo.src = film.trailer;
      heroVideo.load();
      heroVideo.muted = true; // muted by default
      heroVideo.play().catch(()=>{});
      heroVideo.style.opacity = 1; heroPoster.style.opacity = 0;
    } else {
      heroVideo.pause(); heroVideo.src = '';
      heroPoster.style.opacity = 1; heroVideo.style.opacity = 0;
    }

    // handle click
    const banner = document.getElementById('heroBanner');
    banner.onclick = () => { window.location.href = `film.html?navn=${key}` };

    // play knappen spiller full video i modal
    heroPlay.onclick = (e) => { e.stopPropagation(); openModalWith(film) };
    heroTrailerBtn.onclick = (e) => { e.stopPropagation(); openModalWith(film, true) };
  }

  function transitionHeroTo(index) {
    // crossfade
    const fadeDuration = 900;
    // fade out poster to make room for video
    showHeroAt(index);
  }

  muteBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    if (!heroVideo) return;
    heroVideo.muted = !heroVideo.muted;
    muteBtn.innerHTML = heroVideo.muted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
  });

  // -------------------- MODAL PLAYER --------------------
  const playerModal = document.getElementById('playerModal');
  const modalVideo = document.getElementById('modalVideo');
  const closeModalBtn = document.getElementById('closeModal');
  const modalMute = document.getElementById('modalMute');

  function openModalWith(film, forceTrailer=false){
    playerModal.classList.remove('hidden');
    playerModal.setAttribute('aria-hidden','false');
    const src = (forceTrailer && film.trailer) ? film.trailer : (film.sources && film.sources.length ? film.sources[0] : (film.trailer || film.poster || ''));
    modalVideo.src = src;
    modalVideo.muted = false; // modal spiller med lyd
    modalVideo.play().catch(()=>{});
    // sett volumikon
    modalMute.innerHTML = modalVideo.muted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
  }

  closeModalBtn.addEventListener('click', () => { closeModal() });
  playerModal.addEventListener('click', (e) => { if (e.target === playerModal) closeModal() });
  function closeModal(){ modalVideo.pause(); modalVideo.src=''; playerModal.classList.add('hidden'); playerModal.setAttribute('aria-hidden','true') }
  modalMute.addEventListener('click', () => { modalVideo.muted = !modalVideo.muted; modalMute.innerHTML = modalVideo.muted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>' });

  // -------------------- Dynamiske gallerier & hover-preview --------------------
  function createMovieElement(filmKey, film){
    const link = document.createElement('a');
    link.href = `film.html?navn=${filmKey}`;

    const preview = document.createElement('div');
    preview.className = 'card-preview';

    const img = document.createElement('img'); img.src = film.poster; img.alt = film.tittel;
    preview.appendChild(img);

    // hvis trailer finnes, legg til video som preview
    if (film.trailer) {
      const vid = document.createElement('video');
      vid.src = film.trailer; vid.muted = true; vid.playsInline = true; vid.preload = 'metadata';
      preview.appendChild(vid);

      let hoverTimer;
      preview.addEventListener('mouseenter', () => {
        hoverTimer = setTimeout(() => { preview.classList.add('show-video'); vid.currentTime = 0; vid.play().catch(()=>{}); }, 650);
      });
      preview.addEventListener('mouseleave', () => { clearTimeout(hoverTimer); preview.classList.remove('show-video'); vid.pause(); vid.currentTime = 0; });

      // hvis bruker klikker video-ikon får de modal
      preview.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); openModalWith(film, true); });
    }

    link.appendChild(preview);
    return link;
  }

  function createUpcomingMovieElement(filmKey, film){
    const wrapper = document.createElement('div'); wrapper.className = 'coming-movie-item';
    const banner = document.createElement('img'); banner.className='banner'; banner.src = film.bakgrunn || film.poster || ''; banner.alt = film.tittel || '';
    wrapper.appendChild(banner);
    if (film.trailer){ const vid = document.createElement('video'); vid.src = film.trailer; vid.loop=true; vid.muted=true; vid.playsInline=true; wrapper.appendChild(vid); }
    if (film.logo){ const logo = document.createElement('img'); logo.className='logo'; logo.src = film.logo; wrapper.appendChild(logo); }
    const info = document.createElement('div'); info.className='coming-movie-info'; info.innerHTML = film.publishDate ? ('<i class="fas fa-calendar-alt"></i> ' + readableDate(film.publishDate)) : 'Kommer: Ukjent'; wrapper.appendChild(info);

    let hoverTimeout;
    wrapper.addEventListener('mouseenter', () => { wrapper.classList.add('expanded'); hoverTimeout = setTimeout(()=>{ const v = wrapper.querySelector('video'); if (v){ wrapper.classList.add('show-video'); v.currentTime=0; v.play().catch(()=>{});} }, 800); });
    wrapper.addEventListener('mouseleave', () => { clearTimeout(hoverTimeout); wrapper.classList.remove('expanded','show-video'); const v = wrapper.querySelector('video'); if (v){ v.pause(); v.currentTime=0 } });
    wrapper.addEventListener('click', ()=>{ window.location.href = `film.html?navn=${filmKey}` });
    return wrapper;
  }

  function readableDate(d){ try{ const date = new Date(d); const day = date.getDate(); const months = ['Januar','Februar','Mars','April','Mai','Juni','Juli','August','September','Oktober','November','Desember']; return `${day}. ${months[date.getMonth()]}` }catch(e){return 'Ukjent'} }

  function renderGallery(galleryId, filterFunction, sortByPublishDate=false, limit=null){
    const gallery = document.getElementById(galleryId); if(!gallery) return; gallery.innerHTML='';
    const currentDate = new Date();
    let keys = Object.keys(filmer).filter(k => { const f = filmer[k]; if(!f.publishDate) return true; return new Date(f.publishDate) <= currentDate });
    if (filterFunction) keys = keys.filter(filterFunction);
    if (sortByPublishDate) keys.sort((a,b)=> new Date(filmer[b].publishDate||0) - new Date(filmer[a].publishDate||0));
    if (limit) keys = keys.slice(0, limit);
    keys.forEach(k => gallery.appendChild(createMovieElement(k, filmer[k])));
  }

  function renderUpcoming(galleryId){ const gallery = document.getElementById(galleryId); if(!gallery) return; gallery.innerHTML=''; const now = new Date(); const upcoming = Object.keys(filmer).filter(k=>filmer[k].publishDate && new Date(filmer[k].publishDate)>now).sort((a,b)=> new Date(filmer[a].publishDate)-new Date(filmer[b].publishDate)); upcoming.forEach(k=>gallery.appendChild(createUpcomingMovieElement(k,filmer[k]))); }

  function renderTop10(galleryId){ const gallery = document.getElementById(galleryId); if(!gallery) return; gallery.innerHTML=''; let keys = Object.keys(filmer); const today = new Date(); keys = keys.filter(k=> { const f=filmer[k]; if(!f.publishDate) return true; return new Date(f.publishDate)<=today }); const seed = today.getFullYear()*1000 + today.getMonth()*50 + today.getDate(); function seededRandom(s){ const x = Math.sin(s++)*10000; return x - Math.floor(x); } keys.sort((a,b)=> seededRandom(seed + a.length) - seededRandom(seed + b.length)); keys.slice(0,10).forEach((k,i)=>{ const f=filmer[k]; const a = document.createElement('a'); a.href=`film.html?navn=${k}`; a.className='top10-item'; const img = document.createElement('img'); img.src = f.posterVertikal || f.poster; img.alt=f.tittel; const number = document.createElement('div'); number.className='top10-number'; number.textContent = i+1; a.appendChild(img); a.appendChild(number); gallery.appendChild(a); }); }

  function renderSeries(galleryId){ const gallery = document.getElementById(galleryId); if(!gallery || typeof serier==='undefined') return; gallery.innerHTML=''; Object.keys(serier).forEach(k=>{ const s = serier[k]; const link = document.createElement('a'); link.href = `spillerepisode.html?serie=${k}&s=1&e=1`; const img = document.createElement('img'); img.src = s.poster; img.alt = s.tittel; link.appendChild(img); gallery.appendChild(link); }); }

  function renderContinueWatching(){ const section = document.getElementById('fortsett-section'); const gallery = document.getElementById('fortsett-galleri'); if(!section || !gallery) return; gallery.innerHTML=''; const keys = Object.keys(filmer).filter(k=>{ const p = localStorage.getItem('progress_'+k); return p && p>0 && p<100 }); if(keys.length===0){ section.style.display='none'; return } section.style.display='block'; keys.forEach(k=>{ const f = filmer[k]; const p = localStorage.getItem('progress_'+k) || 0; const a = document.createElement('a'); a.href=`film-mal.html?id=${k}`; a.className='image-with-progress'; const img = document.createElement('img'); img.src = f.poster; img.alt=f.tittel; const bar = document.createElement('div'); bar.className='progress-bar'; bar.style.setProperty('--progress', p+'%'); a.appendChild(img); a.appendChild(bar); gallery.appendChild(a); }); }

  // -------------------- INIT --------------------
  document.addEventListener('DOMContentLoaded', ()=>{
    // Safety: hvis filmdata mangler, vis fallback
    if (typeof filmer === 'undefined') { console.warn('Filmdata.js ikke funnet eller "filmer" er undefined. Sørg for at Filmdata.js laster riktig.'); return; }

    renderGallery('nye-filmer-galleri', null, true, 12);
    renderTop10('topp10-filmer-galleri');
    renderGallery('barn-galleri', (key)=>{ const f=filmer[key]; return f.metadata && f.metadata.some(m=>/barn|familie/i.test(m)) });
    renderUpcoming('kommer-snart-galleri');
    renderSeries('serier-galleri');
    renderContinueWatching();
    setupHeroRotation();

    // gallery scroll-knapper og fade-oppdatering
    document.querySelectorAll('.gallery-wrapper').forEach(wrapper=>{
      const gallery = wrapper.querySelector('.image-gallery, .coming-movies-gallery, .top10-gallery');
      const leftBtn = wrapper.querySelector('.scroll-button.left');
      const rightBtn = wrapper.querySelector('.scroll-button.right');
      const fadeLeft = wrapper.querySelector('.fade-left');
      const fadeRight = wrapper.querySelector('.fade-right');
      function updateScroll(){ if(!gallery) return; const left = gallery.scrollLeft; const max = gallery.scrollWidth - gallery.clientWidth; if(leftBtn) leftBtn.classList.toggle('hidden', left<=0); if(rightBtn) rightBtn.classList.toggle('hidden', left>=max); if(fadeLeft) fadeLeft.classList.toggle('fade-hidden', left<=0); if(fadeRight) fadeRight.classList.toggle('fade-hidden', left>=max); }
      if(leftBtn) leftBtn.addEventListener('click', ()=> gallery.scrollBy({left:-340, behavior:'smooth'}));
      if(rightBtn) rightBtn.addEventListener('click', ()=> gallery.scrollBy({left:340, behavior:'smooth'}));
      if(gallery) gallery.addEventListener('scroll', updateScroll);
      updateScroll();
    });
  });

  // Globale hjelpefunksjoner
  function scrollGallery(btn, dir){ const wrapper = btn.closest('.gallery-wrapper'); const gallery = wrapper.querySelector('.image-gallery, .coming-movies-gallery, .top10-gallery'); if(!gallery) return; gallery.scrollBy({ left: dir * gallery.clientWidth * 0.7, behavior: 'smooth' }); }

  </script>
</body>
</html>








