<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Filmvisning</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://static.wixstatic.com/media/fd2fb2_39376e4ee55b460ab7a3ebbfcf35fef7~mv2.png" />

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; font-family: Arial, sans-serif; overflow-x: hidden; }

    /* ===== Container ===== */
    .video-container {
      position: relative;
      width: 100vw;
      max-width: 100%;
      background: black;
    }

    /* Video */
    #videoPlayer {
      width: 100%;
      height: auto;
      object-fit: cover;
    }

    /* Movie title */
    .movie-title {
      position: absolute;
      top: 20px;
      left: 20px;
      color: white;
      font-size: 28px;
      font-weight: bold;
      text-shadow: 2px 2px 5px rgba(0,0,0,0.8);
      z-index: 10;
    }

    /* Subtitles overlay */
    .subtitle-overlay {
      position: absolute;
      bottom: 8%;
      width: 100%;
      text-align: center;
      color: white;
      font-size: 28px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
      z-index: 10;
    }

    /* Progress */
    .progress-container {
      width: 100%;
      margin: 5px 0;
      padding: 0 10px;
    }
    .progress {
      width: 100%;
      height: 6px;
      background: #333;
      border-radius: 5px;
      position: relative;
      cursor: pointer;
    }
    .progress-filled {
      width: 0%;
      height: 100%;
      background: #0fddcb;
      border-radius: 5px;
    }
    .thumb {
      position: absolute;
      top: 50%;
      width: 12px;
      height: 12px;
      background: #fff;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
    }

    /* Time display */
    .time-display {
      text-align: right;
      font-size: 14px;
      color: white;
      margin-top: 4px;
    }

    /* Controls */
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: rgba(0,0,0,0.7);
      flex-wrap: wrap;
    }
    .left-controls, .center-controls, .right-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Buttons */
    .btn {
      background: none;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }
    .like-btn {
      font-size: 14px;
      padding: 6px 12px;
      border-radius: 20px;
      background: rgba(255,255,255,0.1);
    }

    /* ===== Mobil horisontal ===== */
    @media (max-width: 768px) {
      .video-container {
        height: 56.25vw; /* 16:9 ratio */
      }

      .movie-title {
        font-size: 18px;
        top: 10px;
        left: 10px;
      }

      .subtitle-overlay {
        font-size: 16px;
        bottom: 12%;
      }

      .time-display {
        font-size: 12px;
      }

      .btn {
        font-size: 16px;
      }

      .like-btn {
        font-size: 12px;
        padding: 5px 10px;
      }

      .controls {
        flex-direction: row;
        justify-content: space-around;
      }
    }
  </style>
</head>
<body>

<div class="video-container">
  <video id="videoPlayer" preload="metadata" playsinline webkit-playsinline>
    <source src="FILM_URL_HER.mp4" type="video/mp4">
    <track label="Norsk" kind="subtitles" srclang="no" src="SUBTITLE_URL_HER.vtt" default>
    Din nettleser st√∏tter ikke videoavspilling.
  </video>

  <div class="movie-title" id="movieTitle">FILM TITTEL</div>
  <div class="subtitle-overlay" id="subtitleOverlay"></div>

  <!-- Progress og tid -->
  <div class="progress-container">
    <div class="progress" id="progress">
      <div class="progress-filled" id="progressFilled"></div>
      <div class="thumb" id="thumb"></div>
    </div>
    <div class="time-display" id="timeDisplay">00:00 / 00:00</div>
  </div>

  <!-- Kontroller -->
  <div class="controls">
    <div class="left-controls">
      <button class="btn like-btn">Kanskje du ogs√• vil like?</button>
    </div>

    <div class="center-controls">
      <button class="btn" id="rewindBtn">‚è™</button>
      <button class="btn" id="playPauseBtn">‚ñ∂Ô∏è</button>
      <button class="btn" id="forwardBtn">‚è©</button>
    </div>

    <div class="right-controls">
      <button class="btn" id="muteBtn">üîá</button>
      <button class="btn" id="captionsBtn">üí¨</button>
      <button class="btn" id="fullscreenBtn">‚õ∂</button>
    </div>
  </div>
</div>

<script>
const filmer = {
 "corpse-bride": {
    tittel: "Corpse Bride",
    watchUrl: "film-mal.html?id=corpse-bride",
    videoUrl: "https://video.wixstatic.com/video/fd2fb2_a659818165894e4894228ad4804060f4/1080p/mp4/file.mp4",
    subtitleUrl: "Corpse-bride.VTT",
    tilbakeUrl: "film.html?navn=corpse-bride",
    audioLanguages: [{ code: "en", label: "Engelsk" }],
    subtitleLanguages: [
      { code: "no", label: "Norsk" },
      { code: "off", label: "Av" }
    ]
  },
  "hook": {
    tittel: "Hook",
    watchUrl: "film-mal.html?id=hook",
    videoUrl: "https://video.wixstatic.com/video/fd2fb2_4900b93cc027487693fc66246b1ae100/720p/mp4/file.mp4",
    subtitleUrl: "Hook.VTT",
    tilbakeUrl: "film.html?navn=hook",
    audioLanguages: [{ code: "en", label: "Engelsk" }],
    subtitleLanguages: [
      { code: "no", label: "Norsk" },
      { code: "off", label: "Av" }
    ]
  },
  "kaptein-sabeltann": {
    tittel: "Kaptein Sabeltann og den magiske diamant",
    watchUrl: "film-mal.html?id=kaptein-sabeltann",
    videoUrl: "https://video.wixstatic.com/video/fd2fb2_6e01d7be2fda439fb39701d649b7f8b1/1080p/mp4/file.mp4",
    subtitleUrl: "Kaptein-sabeltann.VTT",
    tilbakeUrl: "film.html?navn=kaptein-sabeltann",
    audioLanguages: [{ code: "no", label: "Norsk" }],
    subtitleLanguages: [ { code: "no", label: "Norsk" },
      { code: "off", label: "Av" }]
  },
  "burlesque": {
    tittel: "Burlesque",
    watchUrl: "film-mal.html?id=burlesque",
    videoUrl: "https://video.wixstatic.com/video/fd2fb2_7462cc0c8b1741fe813b5bf84c073e84/720p/mp4/file.mp4",
    subtitleUrl: "Burlesque.VTT",
    tilbakeUrl: "film.html?navn=burlesque",
    audioLanguages: [{ code: "en", label: "Engelsk" }],
    subtitleLanguages: [
      { code: "no", label: "Norsk" },
      { code: "off", label: "Av" }
    ]
  },
  "dog-man": {
    tittel: "Hundemannen",
    watchUrl: "film-mal.html?id=dog-man",
    videoUrl: "https://video.wixstatic.com/video/fd2fb2_f18a5454a4584c6e9b4d7f6e1e97413a/1080p/mp4/file.mp4",
    subtitleUrl: "Dog-man.VTT",
    tilbakeUrl: "film.html?navn=dog-man",
    audioLanguages: [{ code: "no", label: "Norsk" }],
    subtitleLanguages: [
      { code: "no", label: "Norsk" },
      { code: "off", label: "Av" }
    ]
  },
  "dyrene-i-hakkabakkeskogen": {
    tittel: "Dyrene i Hakkabakkeskogen",
    watchUrl: "film-mal.html?id=dyrene-i-hakkabakkeskogen",
    videoUrl: "https://video.wixstatic.com/video/fd2fb2_e702a89f1d8d4d7b8cecfc4692d04493/720p/mp4/file.mp4",
    subtitleUrl: "",
    tilbakeUrl: "film.html?navn=dyrene-i-hakkabakkeskogen",
    audioLanguages: [{ code: "no", label: "Norsk" }],
    subtitleLanguages: []
  },
  "jul-i-fl√•klypa": {
    tittel: "Jul i Fl√•klypa",
    watchUrl: "film-mal.html?id=jul-i-fl√•klypa",
    videoUrl: "https://video.wixstatic.com/video/fd2fb2_26bfed9bfc254af8b14f41820a066eec/720p/mp4/file.mp4",
    subtitleUrl: "Jul-i-fl√•klypa.VTT",
    tilbakeUrl: "film.html?navn=jul-i-fl√•klypa",
    audioLanguages: [{ code: "no", label: "Norsk" }],
    subtitleLanguages: [
      { code: "no", label: "Norsk" },
      { code: "off", label: "Av" }
    ]
  },
  "bamse-og-dunderklokken": {
    tittel: "Bamse og dunderklokken",
    watchUrl: "film-mal.html?id=bamse-og-dunderklokken",
    videoUrl: "https://video.wixstatic.com/video/fd2fb2_747e98649cb54331a25845335a07d608/1080p/mp4/file.mp4",
    subtitleUrl: "Bamse-og-dunderklokken.VTT",
    tilbakeUrl: "film.html?navn=bamse-og-dunderklokken",
    audioLanguages: [{ code: "no", label: "Norsk" }],
    subtitleLanguages: [
      { code: "no", label: "Norsk" },
      { code: "off", label: "Av" }
    ]
  },
  "elio": {
    tittel: "Elio",
    watchUrl: "film-mal.html?id=elio",
    videoUrl: "https://video.wixstatic.com/video/fd2fb2_e2a1c24ef9da432dbdfae032ea242136/720p/mp4/file.mp4",
    subtitleUrl: "Elio.VTT",
    tilbakeUrl: "film.html?navn=elio",
    audioLanguages: [{ code: "no", label: "Norsk" }],
    subtitleLanguages: [
      { code: "no", label: "Norsk" },
      { code: "off", label: "Av" }
    ]
  },
  "elvis": {
    tittel: "Elvis",
    watchUrl: "film-mal.html?id=elvis",
    videoUrl: "https://video.wixstatic.com/video/fd2fb2_9cbfa31964034f40b9471fa95cf6a170/720p/mp4/file.mp4",
    subtitleUrl: "Elvis.VTT",
    tilbakeUrl: "film.html?navn=elvis",
    audioLanguages: [{ code: "en", label: "Engelsk" }],
    subtitleLanguages: [
      { code: "no", label: "Norsk" },
      { code: "off", label: "Av" }
    ]
  },

  "comet-in-moominland": {
    tittel: "Comet in Moominland",
    watchUrl: "film-mal.html?id=comet-in-moominland",
    videoUrl: "https://video.wixstatic.com/video/fd2fb2_b4f49d491bc344f99d49bf3e297648db/720p/mp4/file.mp4",
    subtitleUrl: "",
    tilbakeUrl: "film.html?navn=comet-in-moominland",
    audioLanguages: [{ code: "no", label: "Norsk" }],
    subtitleLanguages: []
  },

    "kongens-nei": {
    tittel: "Kongens Nei",
    watchUrl: "film-mal.html?id=kongens-nei",
    videoUrl: "https://video.wixstatic.com/video/fd2fb2_16a47b758eee49719f0166dd9ee859d7/720p/mp4/file.mp4",
    subtitleUrl: "Kongens nei.VTT",
    tilbakeUrl: "film.html?navn=kongens-nei",
    audioLanguages: [{ code: "no", label: "Norsk" }],
    subtitleLanguages: [{ code: "no", label: "Norsk" },
      { code: "off", label: "Av" }]
  },

    "max-manus": {
    tittel: "Max manus",
    watchUrl: "film-mal.html?id=max-manus",
    videoUrl: "https://video.wixstatic.com/video/fd2fb2_3057b85398be48ce997098642c08485e/720p/mp4/file.mp4",
    subtitleUrl: "",
    tilbakeUrl: "film.html?navn=max-manus",
    audioLanguages: [{ code: "no", label: "Norsk" }],
  },

};

// Hent film-id fra URL
const urlParams = new URLSearchParams(window.location.search);
const filmId = urlParams.get('id')?.toLowerCase().replace(/\s+/g, '-');

if (!filmer[filmId]) {
  alert("Denne filmen finnes ikke.");
  window.location.href = "index.html";
}

const film = filmer[filmId];
document.title = film.tittel;

// DOM-elementer
const video = document.getElementById('video');
const source = video.querySelector('source');
const track = video.querySelector('track');
source.src = film.videoUrl;
track.src = film.subtitleUrl;
video.load();

const titleElement = document.querySelector('.movie-title');
if (titleElement) titleElement.textContent = film.tittel;

const backButton = document.getElementById('backButton');
if (backButton && film.tilbakeUrl) backButton.setAttribute('href', film.tilbakeUrl);

const ui = document.getElementById('ui');
const playBtn = document.getElementById('playPauseBtn');
const playIcon = document.getElementById('playIcon');
const muteBtn = document.getElementById('muteBtn');
const muteIcon = document.getElementById('muteIcon');
const rewindBtn = document.getElementById('rewindBtn');
const forwardBtn = document.getElementById('forwardBtn');
const progress = document.getElementById('progress');
const progressFilled = document.getElementById('progressFilled');
const thumb = document.getElementById('thumb');
const timeDisplay = document.getElementById('timeDisplay');
const captionsBtn = document.getElementById('captionsBtn');
const captionMenu = document.getElementById('captionMenu');
const fullscreenBtn = document.getElementById('fullscreenBtn');
const container = document.getElementById('container');
const loadingSpinner = document.getElementById('loadingSpinner');
const previewBox = document.getElementById('previewBox');
const previewImage = document.getElementById('previewImage');
const previewTime = document.getElementById('previewTime');

// Resume overlay
const resumeOverlay = document.getElementById("resumeOverlay");
const continueBtn = document.getElementById("continueBtn");
const restartBtn = document.getElementById("restartBtn");

// Undertekster overlay
const subtitleOverlay = document.getElementById("subtitleOverlay");

// Variabler
let isDragging = false;
let hideTimeout;
let subtitlesEnabled = true; // styrer om undertekster skal vises

// Format tid til mm:ss
function formatTime(time) {
  const m = Math.floor(time / 60);
  const s = Math.floor(time % 60);
  return `${m}:${s < 10 ? '0' + s : s}`;
}

// Oppdater progress-bar
function updateProgress() {
  if (!isDragging) {
    const percent = (video.currentTime / video.duration) * 100;
    progressFilled.style.width = percent + '%';
    thumb.style.left = percent + '%';
  }
  timeDisplay.textContent = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
}

video.addEventListener('timeupdate', updateProgress);
video.addEventListener('loadedmetadata', updateProgress);

// Play/pause
playBtn.addEventListener('click', () => video.paused ? video.play() : video.pause());
video.addEventListener('click', () => video.paused ? video.play() : video.pause());

document.addEventListener('keydown', e => {
  if (e.code === 'Space') { e.preventDefault(); video.paused ? video.play() : video.pause(); }
  if (e.key === 'ArrowRight') video.currentTime += 10;
  if (e.key === 'ArrowLeft') video.currentTime -= 10;
});

video.addEventListener('play', () => { 
  playIcon.src = "https://static.wixstatic.com/media/fd2fb2_f4658d43d3204506948e5c5ab65461d7~mv2.png"; 
  showUI(); 
});
video.addEventListener('pause', () => { 
  playIcon.src = "https://static.wixstatic.com/media/fd2fb2_f6f25f56b00e49eea8dc4f811b50bb5c~mv2.png"; 
  showUI(); 
});

// Mute
muteBtn.addEventListener('click', () => {
  video.muted = !video.muted;
  muteIcon.src = video.muted
    ? "https://static.wixstatic.com/media/fd2fb2_e7e7e77a59964f018d9e2d4605a047db~mv2.png"
    : "https://static.wixstatic.com/media/fd2fb2_5c4fab8430e94d2381fc487b1654191d~mv2.png";
});

// Rewind/forward
rewindBtn.addEventListener('click', () => video.currentTime = Math.max(0, video.currentTime - 10));
forwardBtn.addEventListener('click', () => video.currentTime = Math.min(video.duration, video.currentTime + 10));

// Captions meny
captionsBtn.addEventListener('click', () => {
  captionMenu.style.display = captionMenu.style.display === 'block' ? 'none' : 'block';
});

// Dynamiske lydknapper
const audioTracksDiv = document.getElementById("audioTracks");
audioTracksDiv.innerHTML = "";
if (film.audioLanguages && film.audioLanguages.length > 0) {
  film.audioLanguages.forEach(lang => {
    const btn = document.createElement("button");
    btn.textContent = lang.label;
    btn.dataset.audio = lang.code;
    btn.addEventListener("click", () => {
      alert(`Lydspr√•k byttet til: ${lang.label}`);
      captionMenu.style.display = "none";
    });
    audioTracksDiv.appendChild(btn);
  });
} else { audioTracksDiv.innerHTML = "<em style='color:gray;'>Ingen valg</em>"; }

// Dynamiske undertekstknapper
const subtitleTracksDiv = document.getElementById("subtitleTracks");
subtitleTracksDiv.innerHTML = "";
if (film.subtitleLanguages && film.subtitleLanguages.length > 0) {
  film.subtitleLanguages.forEach(sub => {
    const btn = document.createElement("button");
    btn.textContent = sub.label;
    btn.dataset.lang = sub.code;
    btn.addEventListener("click", () => {
      const selectedLang = sub.code;
      if (selectedLang === "off") {
        subtitlesEnabled = false;
        for (let i = 0; i < video.textTracks.length; i++) video.textTracks[i].mode = "hidden";
        subtitleOverlay.textContent = "";
      } else {
        subtitlesEnabled = true;
        for (let i = 0; i < video.textTracks.length; i++) {
          const track = video.textTracks[i];
          if (track.language === selectedLang || track.label.toLowerCase() === selectedLang) {
            track.mode = "hidden"; 
            track.addEventListener("cuechange", () => {
              if (!subtitlesEnabled) {
                subtitleOverlay.textContent = "";
                return;
              }
              const cues = track.activeCues;
              subtitleOverlay.textContent = cues && cues.length > 0 ? cues[0].text : "";
            });
          }
        }
      }
      captionMenu.style.display = "none";
    });
    subtitleTracksDiv.appendChild(btn);
  });
} else { subtitleTracksDiv.innerHTML = "<em style='color:gray;'>Ingen undertekster</em>"; }

// Scrub-funksjon
function scrubTo(e) {
  const rect = progress.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const percent = Math.min(Math.max(0, x / rect.width), 1);
  progressFilled.style.width = percent * 100 + '%';
  thumb.style.left = percent * 100 + '%';
  return percent;
}

progress.addEventListener('mousedown', e => { isDragging = true; scrubTo(e); });
document.addEventListener('mouseup', e => { 
  if (isDragging) { 
    const percent = scrubTo(e); 
    video.currentTime = percent * video.duration; 
    isDragging = false; 
    hidePreview(); 
  } 
});
document.addEventListener('mousemove', e => { if (isDragging) { scrubTo(e); showPreview(e); } });
thumb.addEventListener('mousedown', e => { e.preventDefault(); isDragging = true; });

// Preview-bilde
const hiddenVideo = document.createElement("video");
hiddenVideo.src = film.videoUrl;
hiddenVideo.muted = true;
hiddenVideo.crossOrigin = "anonymous";
const canvas = document.createElement("canvas");
const ctx = canvas.getContext("2d");

function showPreview(e) {
  const rect = progress.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const percent = Math.min(Math.max(0, x / rect.width), 1);
  const time = percent * video.duration;

  previewBox.style.left = `${x - 120}px`;
  previewBox.style.display = "block";
  previewTime.textContent = formatTime(time);

  hiddenVideo.currentTime = time;
  hiddenVideo.addEventListener("seeked", function handler() {
    canvas.width = 240;
    canvas.height = 135;
    ctx.drawImage(hiddenVideo, 0, 0, canvas.width, canvas.height);
    previewImage.src = canvas.toDataURL("image/jpeg");
    hiddenVideo.removeEventListener("seeked", handler);
  });
}

function hidePreview() { previewBox.style.display = "none"; }

progress.addEventListener("mousemove", showPreview);
progress.addEventListener("mouseleave", hidePreview);

// UI vis/skjul
function showUI() {
  ui.classList.remove('hidden');
  subtitleOverlay.classList.add("subtitle-up");
  clearTimeout(hideTimeout);
  hideTimeout = setTimeout(() => {
    if (!video.paused) {
      ui.classList.add('hidden');
      subtitleOverlay.classList.remove("subtitle-up");
    }
  }, 3000);
}

document.addEventListener('mousemove', showUI);
document.addEventListener('keydown', showUI);

// Fullscreen
fullscreenBtn.addEventListener('click', () => {
  if (!document.fullscreenElement) { container.requestFullscreen(); }
  else { document.exitFullscreen(); }
});

document.addEventListener('fullscreenchange', () => {
  fullscreenBtn.querySelector('img').src = document.fullscreenElement
    ? "https://static.wixstatic.com/media/fd2fb2_c9b139f2774c4bf7b32c7271fd6c1c1a~mv2.png"
    : "https://static.wixstatic.com/media/fd2fb2_3fa37682b3b34c04a2cd08ffcde2763a~mv2.png";
});

// Loading spinner
video.addEventListener('waiting', () => loadingSpinner.style.display = 'block');
video.addEventListener('playing', () => loadingSpinner.style.display = 'none');
video.addEventListener('canplay', () => loadingSpinner.style.display = 'none');

// Lagre/gjenoppta
const storageKey = filmId;
const savedTime = parseFloat(localStorage.getItem(`${storageKey}-lastPosition`));

video.addEventListener('loadedmetadata', () => {
  if (!isNaN(savedTime) && savedTime > 10 && video.duration > savedTime) {
    video.currentTime = savedTime;
    resumeOverlay.style.display = "flex";

    continueBtn.addEventListener("click", () => {
      resumeOverlay.style.display = "none";
      video.play().catch(err => console.warn("Autoplay blokkert:", err));
    });

    restartBtn.addEventListener("click", () => {
      video.currentTime = 0;
      resumeOverlay.style.display = "none";
      video.play().catch(err => console.warn("Autoplay blokkert:", err));
    });
  } else {
    video.currentTime = 0;
    video.muted = false;
    video.play().catch(err => console.warn("Autoplay blokkert:", err));
  }
});

window.addEventListener('beforeunload', () => {
  localStorage.setItem(`${storageKey}-lastPosition`, video.currentTime);
});

// Ferdig
video.addEventListener('ended', () => {
  localStorage.removeItem(`${storageKey}-lastPosition`);
  localStorage.setItem(`${storageKey}-status`, "ferdig");
  window.location.href = film.tilbakeUrl;
});

// Skjul mus etter delay
let mouseTimer;
const hideCursorDelay = 3000;
function showCursor() {
  document.body.style.cursor = 'default';
  clearTimeout(mouseTimer);
  mouseTimer = setTimeout(() => { document.body.style.cursor = 'none'; }, hideCursorDelay);
}
document.addEventListener('mousemove', showCursor);
mouseTimer = setTimeout(() => { document.body.style.cursor = 'none'; }, hideCursorDelay);

// Skjul alle spor, vi viser manuelt i overlay
for (let i = 0; i < video.textTracks.length; i++) {
  video.textTracks[i].mode = "hidden";
}

// N√∏kkel for √• lagre globalt subtitle-valg (p√• tvers av filmer)
const subtitleSettingKey = "global-subtitle-setting";

// Hent lagret setting (standard: "off")
let globalSubtitleSetting = localStorage.getItem(subtitleSettingKey) || "off";

// Funksjon for √• oppdatere knappene i menyen
function updateSubtitleButtons(activeLang) {
  document.querySelectorAll("#subtitleTracks button").forEach(btn => {
    if (btn.dataset.lang === activeLang) {
      btn.classList.add("active");
    } else {
      btn.classList.remove("active");
    }
  });
}

// N√•r film lastes inn, sett undertekst etter lagret valg
video.addEventListener("loadedmetadata", () => {
  if (globalSubtitleSetting === "off") {
    subtitlesEnabled = false;
    for (let i = 0; i < video.textTracks.length; i++) video.textTracks[i].mode = "hidden";
    subtitleOverlay.textContent = "";
  } else {
    subtitlesEnabled = true;
    for (let i = 0; i < video.textTracks.length; i++) {
      const track = video.textTracks[i];
      if (track.language === globalSubtitleSetting || track.label.toLowerCase() === globalSubtitleSetting) {
        track.mode = "hidden";
        track.addEventListener("cuechange", () => {
          if (!subtitlesEnabled) {
            subtitleOverlay.textContent = "";
            return;
          }
          const cues = track.activeCues;
          subtitleOverlay.textContent = cues && cues.length > 0 ? cues[0].text : "";
        });
      }
    }
  }
  updateSubtitleButtons(globalSubtitleSetting);
});

// N√•r bruker klikker p√• en undertekst-knapp
subtitleTracksDiv.querySelectorAll("button").forEach(btn => {
  btn.addEventListener("click", () => {
    const selectedLang = btn.dataset.lang;
    globalSubtitleSetting = selectedLang;
    localStorage.setItem(subtitleSettingKey, selectedLang); // lagre globalt

    if (selectedLang === "off") {
      subtitlesEnabled = false;
      for (let i = 0; i < video.textTracks.length; i++) video.textTracks[i].mode = "hidden";
      subtitleOverlay.textContent = "";
    } else {
      subtitlesEnabled = true;
      for (let i = 0; i < video.textTracks.length; i++) {
        const track = video.textTracks[i];
        if (track.language === selectedLang || track.label.toLowerCase() === selectedLang) {
          track.mode = "hidden";
          track.addEventListener("cuechange", () => {
            if (!subtitlesEnabled) {
              subtitleOverlay.textContent = "";
              return;
            }
            const cues = track.activeCues;
            subtitleOverlay.textContent = cues && cues.length > 0 ? cues[0].text : "";
          });
        }
      }
    }

    updateSubtitleButtons(selectedLang);
    captionMenu.style.display = "none";
  });
});

</script>




