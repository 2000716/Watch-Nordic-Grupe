<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Filmvisning</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://static.wixstatic.com/media/fd2fb2_39376e4ee55b460ab7a3ebbfcf35fef7~mv2.png" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    /* ===================== STYLES ===================== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; font-family: Arial, sans-serif; overflow: hidden; }
    .container { position: relative; width: 100vw; height: 100vh; overflow: hidden; }
    video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; background: black; z-index: 1; }
    video::cue { font-size: 28px !important; font-weight: 600; color: #FFF; text-shadow: 1px 1px 2px rgba(0,0,0,0.8), -1px -1px 2px rgba(0,0,0,0.8), 1px -1px 2px rgba(0,0,0,0.8), -1px 1px 2px rgba(0,0,0,0.8); line-height: 1.3; white-space: pre-wrap; bottom: 8%; }
    .ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; opacity: 1; transition: opacity 0.5s; }
    .ui.hidden { opacity: 0; pointer-events: none; }
    .top-bar { position: absolute; top: 0; left: 0; width: 100%; padding: 10px 20px; background: linear-gradient(to bottom, rgb(0, 0, 0), rgba(0, 0, 0, 0)); display: flex; align-items: center; }
    .back-button { background: none; border: none; cursor: pointer; }
    .back-button img { width: 50px; height: 50px; }
    .controls { position: absolute; bottom: 0; left: 0; width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0) 90%); }
    .left-controls, .right-controls { display: flex; gap: 25px; align-items: center; }
    .center-controls { position: absolute; left: 50%; transform: translateX(-50%); display: flex; align-items: center; gap: 30px; }
    .btn { background: none; border: none; cursor: pointer; }
    .btn img { width: 32px; }
    .progress-container { position: absolute; bottom: 75px; left: 0; width: 100%; padding: 0 20px; z-index: 12; display: flex; }
    .progress { flex: 1; height: 6px; background: #333; border-radius: 5px; position: relative; cursor: pointer; }
    .progress-filled { width: 0%; height: 100%; background: #0fddcb; border-radius: 5px; }
    .thumb { position: absolute; top: 50%; width: 12px; height: 12px; background: #fff; border-radius: 50%; transform: translate(-50%, -50%); cursor: pointer; z-index: 13; }
    .time-display { position: absolute; bottom: 87px; right: 20px; color: #fff; font-size: 14px; z-index: 12; }
    .caption-menu { position: absolute; bottom: 120px; right: 20px; background: rgba(9,27,30,0.95); border-radius: 10px; padding: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.6); display: none; min-width: 180px; z-index: 10000; }
    .caption-menu strong { display: block; margin: 8px 0 5px; font-size: 14px; font-weight: bold; color: #fff; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 4px; }
    .caption-menu button { display: block; width: 100%; padding: 8px 12px; margin: 2px 0; background-color: transparent; color: #ddd; border: none; text-align: left; font-size: 14px; border-radius: 6px; cursor: pointer; transition: background 0.2s ease; }
    .caption-menu button:hover, .caption-menu button.active { background-color: #0fddcb; color: #000; font-weight: bold; }
    .movie-title { position: absolute; bottom: 100px; left: 30px; color: white; font-size: 28px; font-weight: bold; text-shadow: 2px 2px 5px rgba(0,0,0,0.8); z-index: 12; }
    .loading-spinner { position: absolute; top: 50%; left: 50%; width: 60px; height: 60px; margin: -30px 0 0 -30px; border: 6px solid #333; border-top: 6px solid #0fddcb; border-radius: 50%; animation: spin 1s linear infinite; z-index: 10000; display: none; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .subtitle-overlay { position: absolute; bottom: 5%; width: 100%; text-align: center; pointer-events: none; z-index: 5; font-size: 28px; font-weight: 600; color: #FFF; text-shadow: 1px 1px 2px rgba(0,0,0,0.8), -1px -1px 2px rgba(0,0,0,0.8), 1px -1px 2px rgba(0,0,0,0.8), -1px 1px 2px rgba(0,0,0,0.8); line-height: 1.3; white-space: pre-wrap; transition: bottom 0.5s ease; }
    .subtitle-overlay.subtitle-up { bottom: 15%; }
  </style>
</head>
<body>
  <div class="container" id="container">
    <video id="video" preload="metadata">Din nettleser støtter ikke videoavspilling.</video>
    <div class="subtitle-overlay" id="subtitleOverlay"></div>

    <div class="loading-spinner" id="loadingSpinner"></div>

    <div class="ui" id="ui">
      <div class="top-bar">
        <a href="#" class="back-button" id="backButton">
          <img src="https://static.wixstatic.com/media/fd2fb2_59ea5a2a1ff34303a71a369537dd62c3~mv2.png" alt="Back">
        </a>
      </div>

      <div class="movie-title" id="movieTitle">Tittel</div>

      <div class="progress-container">
        <div class="progress" id="progress">
          <div class="progress-filled" id="progressFilled"></div>
          <div class="thumb" id="thumb"></div>
        </div>
      </div>

      <span class="time-display" id="timeDisplay">00:00</span>

      <div class="controls">
        <div class="left-controls">
          <button class="btn like-btn">Kanskje du også vil like?</button>
        </div>

        <div class="center-controls">
          <button class="btn" id="rewindBtn"><img src="https://static.wixstatic.com/media/fd2fb2_a6f7229c8e994a75a12d5849e71156a9~mv2.png" alt="Rewind"></button>
          <button class="btn" id="playPauseBtn"><img id="playIcon" src="https://static.wixstatic.com/media/fd2fb2_f6f25f56b00e49eea8dc4f811b50bb5c~mv2.png" alt="Play/Pause"></button>
          <button class="btn" id="forwardBtn"><img src="https://static.wixstatic.com/media/fd2fb2_08262621a72944c498e8124d461ce786~mv2.png" alt="Forward"></button>
        </div>

        <div class="right-controls">
          <button class="btn" id="muteBtn"><img id="muteIcon" src="https://static.wixstatic.com/media/fd2fb2_5c4fab8430e94d2381fc487b1654191d~mv2.png" alt="Mute"></button>
          <button class="btn" id="captionsBtn"><img src="https://static.wixstatic.com/media/fd2fb2_25072ee44a734507912f0b65f9fc9b0e~mv2.png" alt="Captions"></button>
          <button class="btn" id="fullscreenBtn" title="Fullskjerm"><img src="https://static.wixstatic.com/media/fd2fb2_3fa37682b3b34c04a2cd08ffcde2763a~mv2.png" alt="Fullscreen"></button>
        </div>
      </div>

      <div class="caption-menu" id="captionMenu">
        <strong>Lydspråk</strong>
        <div id="audioTracks"></div>
        <strong>Undertekster</strong>
        <div id="subtitleTracks"></div>
      </div>
    </div>
  </div>

  <!-- FILMDATA -->
  <script src="Filmdata.js"></script>

  <!-- PLAY SCRIPT -->
  <script>
  // ===================== FILMDATA =====================
  const urlParams = new URLSearchParams(window.location.search);
  const filmId = urlParams.get('id')?.toLowerCase().replace(/\s+/g, '-');

  if (!filmId || !filmer[filmId]) {
    alert("Denne filmen finnes ikke.");
    window.location.href = "filmer.html";
  }

  const film = filmer[filmId];
  document.title = film.tittel;

  // ===================== DOM ELEMENTS =====================
  const video = document.getElementById('video');
  const titleElement = document.getElementById('movieTitle');
  const backButton = document.getElementById('backButton');
  const playBtn = document.getElementById('playPauseBtn');
  const playIcon = document.getElementById('playIcon');
  const muteBtn = document.getElementById('muteBtn');
  const muteIcon = document.getElementById('muteIcon');
  const rewindBtn = document.getElementById('rewindBtn');
  const forwardBtn = document.getElementById('forwardBtn');
  const progress = document.getElementById('progress');
  const progressFilled = document.getElementById('progressFilled');
  const thumb = document.getElementById('thumb');
  const timeDisplay = document.getElementById('timeDisplay');
  const captionsBtn = document.getElementById('captionsBtn');
  const captionMenu = document.getElementById('captionMenu');
  const subtitleTracksDiv = document.getElementById('subtitleTracks');
  const fullscreenBtn = document.getElementById('fullscreenBtn');
  const container = document.getElementById('container');
  const loadingSpinner = document.getElementById('loadingSpinner');
  const subtitleOverlay = document.getElementById("subtitleOverlay");

  // ===================== VIDEO SETUP =====================
  titleElement.textContent = film.tittel;
  if (backButton && film.tilbakeUrl) backButton.href = film.tilbakeUrl;

  video.src = film.videoUrl;
  video.autoplay = true;

  if (film.subtitleUrl) {
    const track = document.createElement("track");
    track.kind = "subtitles";
    track.src = film.subtitleUrl;
    track.label = "Norsk";
    track.srclang = "no";
    track.default = true;
    video.appendChild(track);
  }

  // ===================== VARIABLES =====================
  let isDragging = false;
  let hideTimeout;

  // ===================== FUNCTIONS =====================
  function formatTime(time) {
    const m = Math.floor(time / 60);
    const s = Math.floor(time % 60);
    return `${m}:${s < 10 ? '0'+s : s}`;
  }

  function updateProgress() {
    if (!isDragging) {
      const percent = (video.currentTime / video.duration) * 100;
      progressFilled.style.width = percent + '%';
      thumb.style.left = percent + '%';
    }
    timeDisplay.textContent = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
  }

  function showUI() {
    document.getElementById('ui').classList.remove('hidden');
    subtitleOverlay.classList.add("subtitle-up");
    clearTimeout(hideTimeout);
    hideTimeout = setTimeout(() => {
      if (!video.paused) {
        document.getElementById('ui').classList.add('hidden');
        subtitleOverlay.classList.remove("subtitle-up");
      }
    }, 3000);
  }

  function scrubTo(e) {
    const rect = progress.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const percent = Math.min(Math.max(0, x / rect.width), 1);
    progressFilled.style.width = percent*100 + '%';
    thumb.style.left = percent*100 + '%';
    return percent;
  }

  // ===================== EVENTS =====================
  playBtn.addEventListener('click', () => video.paused ? video.play() : video.pause());
  video.addEventListener('click', () => video.paused ? video.play() : video.pause());
  video.addEventListener('play', () => { playIcon.src="https://static.wixstatic.com/media/fd2fb2_f4658d43d3204506948e5c5ab65461d7~mv2.png"; showUI(); });
  video.addEventListener('pause', () => { playIcon.src="https://static.wixstatic.com/media/fd2fb2_f6f25f56b00e49eea8dc4f811b50bb5c~mv2.png"; showUI(); });

  muteBtn.addEventListener('click', () => {
    video.muted = !video.muted;
    muteIcon.src = video.muted
      ? "https://static.wixstatic.com/media/fd2fb2_e7e7e77a59964f018d9e2d4605a047db~mv2.png"
      : "https://static.wixstatic.com/media/fd2fb2_5c4fab8430e94d2381fc487b1654191d~mv2.png";
  });

  rewindBtn.addEventListener('click', () => video.currentTime = Math.max(0, video.currentTime - 10));
  forwardBtn.addEventListener('click', () => video.currentTime = Math.min(video.duration, video.currentTime + 10));

  progress.addEventListener('mousedown', e => { isDragging=true; scrubTo(e); });
  document.addEventListener('mouseup', e => { if(isDragging){ video.currentTime=scrubTo(e)*video.duration; isDragging=false; }});
  document.addEventListener('mousemove', e => { if(isDragging) scrubTo(e); });
  thumb.addEventListener('mousedown', e => { e.preventDefault(); isDragging=true; });

  fullscreenBtn.addEventListener('click', () => {
    if(!document.fullscreenElement) container.requestFullscreen();
    else document.exitFullscreen();
  });

  document.addEventListener('fullscreenchange', () => {
    fullscreenBtn.querySelector('img').src = document.fullscreenElement
      ? "https://static.wixstatic.com/media/fd2fb2_c9b139f2774c4bf7b32c7271fd6c1c1a~mv2.png"
      : "https://static.wixstatic.com/media/fd2fb2_3fa37682b3b34c04a2cd08ffcde2763a~mv2.png";
  });

  video.addEventListener('timeupdate', updateProgress);
  video.addEventListener('loadedmetadata', updateProgress);
  video.addEventListener('waiting', () => loadingSpinner.style.display='block');
  video.addEventListener('playing', () => loadingSpinner.style.display='none');

  // Undertekster
  if(film.subtitleLanguages) {
    film.subtitleLanguages.forEach(lang => {
      const btn = document.createElement("button");
      btn.textContent = lang.label;
      btn.dataset.lang = lang.code;
      btn.addEventListener('click', () => {
        if(lang.code === "off") {
          for(const track of video.textTracks) track.mode="disabled";
        } else {
          for(const track of video.textTracks) track.mode = track.language === lang.code ? "showing" : "disabled";
        }
        updateSubtitleButtons(lang.code);
      });
      subtitleTracksDiv.appendChild(btn);
    });
  }

  function updateSubtitleButtons(activeLang) {
    document.querySelectorAll("#subtitleTracks button").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.lang === activeLang);
    });
  }
  </script>
</body>
</html>


















