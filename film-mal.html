<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Filmvisning</title>
  <link rel="icon" type="image/png" href="https://static.wixstatic.com/media/fd2fb2_39376e4ee55b460ab7a3ebbfcf35fef7~mv2.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="style.css"> <!-- Din CSS fra originalen -->
</head>
<body>
  <div class="container" id="container">
    <!-- VIDEOELEMENT -->
    <video id="video" preload="metadata">
      Din nettleser støtter ikke videoavspilling.
    </video>
    
    <div class="subtitle-overlay" id="subtitleOverlay"></div>

    <!-- Resume overlay -->
    <div id="resumeOverlay" class="resume-overlay">
      <div class="resume-box">
        <p>Vil du fortsette der du slapp?</p>
        <div class="resume-buttons">
          <button id="continueBtn">Fortsett</button>
          <button id="restartBtn">Start på nytt</button>
        </div>
      </div>
    </div>

    <div class="loading-spinner" id="loadingSpinner"></div>

    <div class="preview-box" id="previewBox">
      <img id="previewImage" src="" alt="Preview">
      <div class="preview-time" id="previewTime">00:00</div>
    </div>

    <!-- UI Kontroller -->
    <div class="ui" id="ui">
      <div class="top-bar">
        <a href="#" class="back-button" id="backButton">
          <img src="https://static.wixstatic.com/media/fd2fb2_59ea5a2a1ff34303a71a369537dd62c3~mv2.png" alt="Back">
        </a>
      </div>

      <div class="movie-title" id="movieTitle">Tittel</div>

      <div class="progress-container">
        <div class="progress" id="progress">
          <div class="progress-filled" id="progressFilled"></div>
          <div class="thumb" id="thumb"></div>
        </div>
      </div>

      <span class="time-display" id="timeDisplay">00:00</span>

      <div class="controls">
        <div class="left-controls">
          <button class="btn like-btn">Kanskje du også vil like?</button>
        </div>

        <div class="center-controls">
          <button class="btn" id="rewindBtn">
            <img src="https://static.wixstatic.com/media/fd2fb2_a6f7229c8e994a75a12d5849e71156a9~mv2.png" alt="Rewind">
          </button>
          <button class="btn" id="playPauseBtn">
            <img id="playIcon" src="https://static.wixstatic.com/media/fd2fb2_f6f25f56b00e49eea8dc4f811b50bb5c~mv2.png" alt="Play/Pause">
          </button>
          <button class="btn" id="forwardBtn">
            <img src="https://static.wixstatic.com/media/fd2fb2_08262621a72944c498e8124d461ce786~mv2.png" alt="Forward">
          </button>
        </div>

        <div class="right-controls">
          <button class="btn" id="muteBtn">
            <img id="muteIcon" src="https://static.wixstatic.com/media/fd2fb2_5c4fab8430e94d2381fc487b1654191d~mv2.png" alt="Mute">
          </button>
          <button class="btn" id="captionsBtn">
            <img src="https://static.wixstatic.com/media/fd2fb2_25072ee44a734507912f0b65f9fc9b0e~mv2.png" alt="Captions">
          </button>
          <button class="btn" id="fullscreenBtn" title="Fullskjerm">
            <img src="https://static.wixstatic.com/media/fd2fb2_3fa37682b3b34c04a2cd08ffcde2763a~mv2.png" alt="Fullscreen">
          </button>
        </div>
      </div>

      <div class="caption-menu" id="captionMenu">
        <strong>Lydspråk</strong>
        <div id="audioTracks"></div>
        <strong>Undertekster</strong>
        <div id="subtitleTracks"></div>
      </div>
    </div>
  </div>

  <!-- FILMDATA -->
  <script src="Filmdata.js"></script>

  <!-- JS PLAY -->
  <script src="play.js">
  // ===================== FILMDATA =====================
const urlParams = new URLSearchParams(window.location.search);
const filmId = urlParams.get('id')?.toLowerCase().replace(/\s+/g, '-');

if (!filmId || !filmer[filmId]) {
  alert("Denne filmen finnes ikke.");
  window.location.href = "filmer.html";
}

const film = filmer[filmId];
document.title = film.tittel;

// ===================== DOM =====================
const video = document.getElementById('video');
const titleElement = document.getElementById('movieTitle');
titleElement.textContent = film.tittel;

const backButton = document.getElementById('backButton');
if (backButton && film.tilbakeUrl) backButton.href = film.tilbakeUrl;

const ui = document.getElementById('ui');
const playBtn = document.getElementById('playPauseBtn');
const playIcon = document.getElementById('playIcon');
const muteBtn = document.getElementById('muteBtn');
const muteIcon = document.getElementById('muteIcon');
const rewindBtn = document.getElementById('rewindBtn');
const forwardBtn = document.getElementById('forwardBtn');
const progress = document.getElementById('progress');
const progressFilled = document.getElementById('progressFilled');
const thumb = document.getElementById('thumb');
const timeDisplay = document.getElementById('timeDisplay');
const captionsBtn = document.getElementById('captionsBtn');
const captionMenu = document.getElementById('captionMenu');
const fullscreenBtn = document.getElementById('fullscreenBtn');
const container = document.getElementById('container');
const loadingSpinner = document.getElementById('loadingSpinner');
const previewBox = document.getElementById('previewBox');
const previewImage = document.getElementById('previewImage');
const previewTime = document.getElementById('previewTime');

const resumeOverlay = document.getElementById("resumeOverlay");
const continueBtn = document.getElementById("continueBtn");
const restartBtn = document.getElementById("restartBtn");

const subtitleOverlay = document.getElementById("subtitleOverlay");

// ===================== VIDEO SETUP =====================
const source = document.createElement("source");
source.src = film.videoUrl;
source.type = "video/mp4";
video.appendChild(source);

// Undertekster
if (film.subtitleUrl) {
  const track = document.createElement("track");
  track.kind = "subtitles";
  track.src = film.subtitleUrl;
  track.label = "Norsk";
  track.srclang = "no";
  track.default = true;
  video.appendChild(track);
}

video.load();
video.autoplay = true;

// ===================== VARIABLES =====================
let isDragging = false;
let hideTimeout;
let subtitlesEnabled = true;
const subtitleSettingKey = "global-subtitle-setting";
let globalSubtitleSetting = localStorage.getItem(subtitleSettingKey) || "off";

// ===================== FUNCTIONS =====================
function formatTime(time) {
  const m = Math.floor(time / 60);
  const s = Math.floor(time % 60);
  return `${m}:${s < 10 ? '0'+s : s}`;
}

function updateProgress() {
  if (!isDragging) {
    const percent = (video.currentTime / video.duration) * 100;
    progressFilled.style.width = percent + '%';
    thumb.style.left = percent + '%';
  }
  timeDisplay.textContent = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
  if (!isNaN(video.duration) && video.duration > 0) {
    localStorage.setItem("progress_" + filmId, ((video.currentTime/video.duration)*100).toFixed(1));
  }
}

function showUI() {
  ui.classList.remove('hidden');
  subtitleOverlay.classList.add("subtitle-up");
  clearTimeout(hideTimeout);
  hideTimeout = setTimeout(() => {
    if (!video.paused) {
      ui.classList.add('hidden');
      subtitleOverlay.classList.remove("subtitle-up");
    }
  }, 3000);
}

function scrubTo(e) {
  const rect = progress.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const percent = Math.min(Math.max(0, x / rect.width), 1);
  progressFilled.style.width = percent*100 + '%';
  thumb.style.left = percent*100 + '%';
  return percent;
}

function showPreview(e) {
  const rect = progress.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const percent = Math.min(Math.max(0, x / rect.width), 1);
  const time = percent * video.duration;

  previewBox.style.left = `${x - 120}px`;
  previewBox.style.display = "block";
  previewTime.textContent = formatTime(time);

  const hiddenVideo = document.createElement("video");
  hiddenVideo.src = film.videoUrl;
  hiddenVideo.muted = true;
  hiddenVideo.crossOrigin = "anonymous";

  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  hiddenVideo.currentTime = time;
  hiddenVideo.addEventListener("seeked", function handler() {
    canvas.width = 240;
    canvas.height = 135;
    ctx.drawImage(hiddenVideo,0,0,canvas.width,canvas.height);
    previewImage.src = canvas.toDataURL("image/jpeg");
    hiddenVideo.removeEventListener("seeked", handler);
  });
}

function hidePreview() { previewBox.style.display = "none"; }

function updateSubtitleButtons(activeLang) {
  document.querySelectorAll("#subtitleTracks button").forEach(btn => {
    btn.classList.toggle("active", btn.dataset.lang === activeLang);
  });
}

// ===================== EVENTS =====================
video.addEventListener('timeupdate', updateProgress);
video.addEventListener('loadedmetadata', updateProgress);

// Play/pause
playBtn.addEventListener('click', () => video.paused ? video.play() : video.pause());
video.addEventListener('click', () => video.paused ? video.play() : video.pause());
video.addEventListener('play', () => { playIcon.src="https://static.wixstatic.com/media/fd2fb2_f4658d43d3204506948e5c5ab65461d7~mv2.png"; showUI(); });
video.addEventListener('pause', () => { playIcon.src="https://static.wixstatic.com/media/fd2fb2_f6f25f56b00e49eea8dc4f811b50bb5c~mv2.png"; showUI(); });

// Mute
muteBtn.addEventListener('click', () => {
  video.muted = !video.muted;
  muteIcon.src = video.muted
    ? "https://static.wixstatic.com/media/fd2fb2_e7e7e77a59964f018d9e2d4605a047db~mv2.png"
    : "https://static.wixstatic.com/media/fd2fb2_5c4fab8430e94d2381fc487b1654191d~mv2.png";
});

// Rewind/Forward
rewindBtn.addEventListener('click', () => video.currentTime = Math.max(0, video.currentTime - 10));
forwardBtn.addEventListener('click', () => video.currentTime = Math.min(video.duration, video.currentTime + 10));

// Captions menu
captionsBtn.addEventListener('click', () => {
  captionMenu.style.display = captionMenu.style.display === 'block' ? 'none' : 'block';
});

// Scrub
progress.addEventListener('mousedown', e => { isDragging=true; scrubTo(e); });
document.addEventListener('mouseup', e => { if(isDragging){ video.currentTime=scrubTo(e)*video.duration; isDragging=false; hidePreview(); }});
document.addEventListener('mousemove', e => { if(isDragging){ scrubTo(e); showPreview(e); }});
thumb.addEventListener('mousedown', e => { e.preventDefault(); isDragging=true; });

// Preview mousemove
progress.addEventListener('mousemove', showPreview);
progress.addEventListener('mouseleave', hidePreview);

// Fullscreen
fullscreenBtn.addEventListener('click', () => {
  if(!document.fullscreenElement) container.requestFullscreen();
  else document.exitFullscreen();
});
document.addEventListener('fullscreenchange', () => {
  fullscreenBtn.querySelector('img').src = document.fullscreenElement
    ? "https://static.wixstatic.com/media/fd2fb2_c9b139f2774c4bf7b32c7271fd6c1c1a~mv2.png"
    : "https://static.wixstatic.com/media/fd2fb2_3fa37682b3b34c04a2cd08ffcde2763a~mv2.png";
});

// Loading spinner
video.addEventListener('waiting', () => loadingSpinner.style.display='block');
video.addEventListener('playing', () => loadingSpinner.style.display='none');
video.addEventListener('canplay', () => loadingSpinne
</script>
</body>
</html>




















