<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Filmvisning</title>
<link rel="icon" href="https://static.wixstatic.com/media/fd2fb2_39376e4ee55b460ab7a3ebbfcf35fef7~mv2.png" type="image/png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
/* ======================= RESET ======================= */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: Arial, sans-serif; background: #000; overflow: hidden; color: #fff; }

/* ======================= CONTAINER ======================= */
.container { position: relative; width: 100vw; height: 100vh; overflow: hidden; }
video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; background: #000; z-index: 1; }
video::cue { font-size: 28px; font-weight: 600; color: #fff; text-shadow: 1px 1px 2px rgba(0,0,0,0.8); line-height: 1.3; }

/* ======================= OVERLAY ======================= */
.subtitle-overlay { position: absolute; bottom: 5%; width: 100%; text-align: center; z-index: 5; font-size: 28px; font-weight: 600; text-shadow: 1px 1px 2px rgba(0,0,0,0.8); transition: bottom 0.5s ease; }
.subtitle-overlay.subtitle-up { bottom: 15%; }

.loading-spinner { position: absolute; top: 50%; left: 50%; width: 60px; height: 60px; margin: -30px 0 0 -30px; border: 6px solid #333; border-top: 6px solid #0fddcb; border-radius: 50%; animation: spin 1s linear infinite; z-index: 10000; display: none; }
@keyframes spin { to { transform: rotate(360deg); } }

.preview-box { position: absolute; bottom: 120px; width: 240px; height: 135px; border: 2px solid #0fddcb; border-radius: 10px; overflow: hidden; background: #000; display: none; z-index: 20; pointer-events: none; }
.preview-box img { width: 100%; height: auto; display: block; }
.preview-time { position: absolute; bottom: 0; width: 100%; text-align: center; background: rgba(0,0,0,0.6); color: #fff; font-size: 14px; font-weight: bold; }

/* ======================= UI ======================= */
.ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; transition: opacity 0.5s ease; }
.ui.hidden { opacity: 0; pointer-events: none; }
.ui .top-bar, .ui .controls, .ui .progress-container, .ui .caption-menu { pointer-events: auto; }

.top-bar { position: absolute; top: 0; left: 0; width: 100%; padding: 10px 20px; display: flex; align-items: center; background: linear-gradient(to bottom, rgba(0,0,0,1), rgba(0,0,0,0)); }
.back-button { background: none; border: none; cursor: pointer; }
.back-button img { width: 50px; height: 50px; }

.controls { position: absolute; bottom: 0; left: 0; width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: linear-gradient(to top, rgba(0,0,0,0.95), rgba(0,0,0,0)); }
.controls .left-controls, .controls .right-controls { display: flex; gap: 25px; align-items: center; }
.center-controls { position: absolute; left: 50%; transform: translateX(-50%); display: flex; gap: 30px; align-items: center; }

.btn { background: none; border: none; cursor: pointer; }
.btn img { width: 32px; }

.progress-container { position: absolute; bottom: 75px; left: 0; width: 100%; padding: 0 20px; z-index: 12; display: flex; }
.progress { flex: 1; height: 6px; background: #333; border-radius: 5px; position: relative; cursor: pointer; }
.progress-filled { width: 0%; height: 100%; background: #0fddcb; border-radius: 5px; }
.thumb { position: absolute; top: 50%; width: 12px; height: 12px; border-radius: 50%; background: #fff; transform: translate(-50%, -50%); cursor: pointer; z-index: 13; }
.time-display { position: absolute; bottom: 87px; right: 20px; font-size: 14px; color: #fff; z-index: 12; }

.caption-menu { position: absolute; bottom: 120px; right: 20px; background: rgba(9,27,30,0.95); border-radius: 10px; padding: 12px; min-width: 180px; display: none; z-index: 10000; }
.caption-menu strong { display: block; margin: 8px 0 5px; font-size: 14px; font-weight: bold; color: #fff; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 4px; }
.caption-menu button { display: block; width: 100%; padding: 8px 12px; margin: 2px 0; background: transparent; border: none; text-align: left; color: #ddd; font-size: 14px; border-radius: 6px; cursor: pointer; }
.caption-menu button:hover, .caption-menu button.active { background: #0fddcb; color: #000; font-weight: bold; }

.movie-title { position: absolute; bottom: 100px; left: 30px; font-size: 28px; font-weight: bold; text-shadow: 2px 2px 5px rgba(0,0,0,0.8); z-index: 12; }
.watermark { position: absolute; top: 20px; right: 20px; width: 60px; pointer-events: none; z-index: 1000; }

/* ======================= RESUME OVERLAY ======================= */
.resume-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); display:none; justify-content:center; align-items:center; z-index:999999; }
.resume-box { background:none; padding:30px; text-align:center; color:#fff; border-radius:12px; }
.resume-buttons { display:flex; justify-content:center; gap:20px; }
.resume-buttons button { padding:10px 20px; font-size:16px; font-weight:bold; border:none; border-radius:8px; cursor:pointer; transition:0.2s; }

/* ======================= MINI PLAYER ======================= */
.miniplayer { position: fixed; width: 320px; height:180px; bottom:20px; right:20px; z-index:99999; border:2px solid #0fddcb; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.7); background:black; cursor: move; }

/* ======================= RESPONSIVE ======================= */
@media (max-width:768px){
  .movie-title{ font-size:16px; bottom:70px; left:12px; }
  .controls{ padding:8px 10px; gap:12px; }
  .btn img{ width:24px; height:24px; }
  .like-btn{ font-size:14px; padding:6px 10px; }
  .progress-container{ bottom:58px; padding:0 10px; }
  .progress{ height:5px; }
  .thumb{ width:10px; height:10px; }
  .time-display{ font-size:12px; bottom:70px; right:10px; }
  video::cue, .subtitle-overlay{ font-size:17px !important; bottom:13% !important; }
  .subtitle-overlay.subtitle-up{ bottom:22% !important; }
}
@media (max-width:420px){
  .movie-title{ font-size:14px; bottom:64px; }
  video::cue, .subtitle-overlay{ font-size:15px !important; bottom:11% !important; }
  .subtitle-overlay.subtitle-up{ bottom:20% !important; }
  .progress-container{ bottom:50px; }
  .time-display{ font-size:11px; bottom:62px; right:8px; }
  .btn img{ width:20px; height:20px; }
  .like-btn{ font-size:12px; padding:4px 8px; }
}
</style>
</head>
<body>
<div class="container" id="container">
  <video id="video" preload="metadata">
    <source src="" type="video/mp4">
    <track label="Norsk" kind="subtitles" srclang="no" src="" default>
    Din nettleser støtter ikke video.
  </video>
  <div class="subtitle-overlay" id="subtitleOverlay"></div>

  <div id="resumeOverlay" class="resume-overlay">
    <div class="resume-box">
      <p>Vil du fortsette der du slapp?</p>
      <div class="resume-buttons">
        <button id="continueBtn">Fortsett</button>
        <button id="restartBtn">Start på nytt</button>
      </div>
    </div>
  </div>

  <div class="loading-spinner" id="loadingSpinner"></div>
  <div class="preview-box" id="previewBox">
    <img id="previewImage" src="" alt="Preview">
    <div class="preview-time" id="previewTime">00:00</div>
  </div>

  <div class="ui" id="ui">
    <div class="top-bar">
      <a href="#" class="back-button" id="backButton">
        <img src="https://static.wixstatic.com/media/fd2fb2_59ea5a2a1ff34303a71a369537dd62c3~mv2.png" alt="Back">
      </a>
    </div>

    <div class="movie-title" id="movieTitle">The Curse of the Were-Rabbit</div>

    <div class="progress-container">
      <div class="progress" id="progress">
        <div class="progress-filled" id="progressFilled"></div>
        <div class="thumb" id="thumb"></div>
      </div>
    </div>

    <div class="controls">
      <div class="left-controls">
        <button class="btn like-btn">Kanskje du også vil like?</button>
      </div>
      <div class="center-controls">
        <button class="btn" id="rewindBtn"><img src="https://static.wixstatic.com/media/fd2fb2_a6f7229c8e994a75a12d5849e71156a9~mv2.png"></button>
        <button class="btn" id="playPauseBtn"><img id="playIcon" src="https://static.wixstatic.com/media/fd2fb2_f6f25f56b00e49eea8dc4f811b50bb5c~mv2.png"></button>
        <button class="btn" id="forwardBtn"><img src="https://static.wixstatic.com/media/fd2fb2_08262621a72944c498e8124d461ce786~mv2.png"></button>
      </div>
      <div class="right-controls">
        <button class="btn" id="muteBtn"><img id="muteIcon" src="https://static.wixstatic.com/media/fd2fb2_5c4fab8430e94d2381fc487b1654191d~mv2.png"></button>
        <button class="btn" id="captionsBtn"><img src="https://static.wixstatic.com/media/fd2fb2_25072ee44a734507912f0b65f9fc9b0e~mv2.png"></button>
        <button class="btn" id="fullscreenBtn"><img src="https://static.wixstatic.com/media/fd2fb2_3fa37682b3b34c04a2cd08ffcde2763a~mv2.png"></button>
      </div>
    </div>

    <div class="caption-menu" id="captionMenu">
      <strong>Lydspråk</strong>
      <div id="audioTracks"></div>
      <strong>Undertekster</strong>
      <div id="subtitleTracks"></div>
    </div>
  </div>
</div>

<script src="Filmdata.js"></script>
<script>
// ======================= MODULBASERT JS =======================
const video = document.getElementById("video");
const playBtn = document.getElementById("playPauseBtn");
const playIcon = document.getElementById("playIcon");
const muteBtn = document.getElementById("muteBtn");
const muteIcon = document.getElementById("muteIcon");
const rewindBtn = document.getElementById("rewindBtn");
const forwardBtn = document.getElementById("forwardBtn");
const progress = document.getElementById("progress");
const progressFilled = document.getElementById("progressFilled");
const thumb = document.getElementById("thumb");
const timeDisplay = document.getElementById("timeDisplay");
const subtitleOverlay = document.getElementById("subtitleOverlay");
const ui = document.getElementById("ui");
const captionMenu = document.getElementById("captionMenu");
const audioTracksDiv = document.getElementById("audioTracks");
const subtitleTracksDiv = document.getElementById("subtitleTracks");
const resumeOverlay = document.getElementById("resumeOverlay");
const continueBtn = document.getElementById("continueBtn");
const restartBtn = document.getElementById("restartBtn");
const previewBox = document.getElementById("previewBox");
const previewImage = document.getElementById("previewImage");
const previewTime = document.getElementById("previewTime");

// ======================= UTILITY =======================
const formatTime = t => `${Math.floor(t/60)}:${String(Math.floor(t%60)).padStart(2,"0")}`;
let isDragging = false;
let hideTimeout;
let subtitlesEnabled = true;

// ======================= PROGRESS =======================
function updateProgress(){
  const percent = (video.currentTime/video.duration)*100;
  if(!isDragging){ progressFilled.style.width=percent+"%"; thumb.style.left=percent+"%"; }
  if(timeDisplay) timeDisplay.textContent = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
  if(!isNaN(video.duration)) localStorage.setItem("progress_"+filmId,(percent.toFixed(1)));
}
video.addEventListener("timeupdate",updateProgress);
video.addEventListener("loadedmetadata",updateProgress);

// ======================= PLAY/PAUSE =======================
const togglePlay = ()=>video.paused?video.play():video.pause();
playBtn.addEventListener("click",togglePlay);
video.addEventListener("click",togglePlay);
video.addEventListener("play",()=>{playIcon.src="https://static.wixstatic.com/media/fd2fb2_f4658d43d3204506948e5c5ab65461d7~mv2.png";showUI();});
video.addEventListener("pause",()=>{playIcon.src="https://static.wixstatic.com/media/fd2fb2_f6f25f56b00e49eea8dc4f811b50bb5c~mv2.png";showUI();});

// ======================= MUTE =======================
muteBtn.addEventListener("click",()=>{
  video.muted = !video.muted;
  muteIcon.src = video.muted
    ?"https://static.wixstatic.com/media/fd2fb2_e7e7e77a59964f018d9e2d4605a047db~mv2.png"
    :"https://static.wixstatic.com/media/fd2fb2_5c4fab8430e94d2381fc487b1654191d~mv2.png";
});

// ======================= SEEK =======================
rewindBtn.addEventListener("click",()=>video.currentTime=Math.max(0,video.currentTime-10));
forwardBtn.addEventListener("click",()=>video.currentTime=Math.min(video.duration,video.currentTime+10));

function scrubTo(e){
  const rect=progress.getBoundingClientRect();
  const x=e.clientX-rect.left;
  const percent=Math.min(Math.max(0,x/rect.width),1);
  progressFilled.style.width=percent*100+"%";
  thumb.style.left=percent*100+"%";
  return percent;
}
progress.addEventListener("mousedown", e=>{isDragging=true; scrubTo(e);});
document.addEventListener("mouseup", e=>{if(isDragging){video.currentTime=scrubTo(e)*video.duration;isDragging=false;hidePreview();}});
document.addEventListener("mousemove", e=>{if(isDragging){scrubTo(e);showPreview(e);}});
thumb.addEventListener("mousedown", e=>{e.preventDefault();isDragging=true;});

// ======================= PREVIEW =======================
const hiddenVideo=document.createElement("video"); hiddenVideo.src=film.videoUrl; hiddenVideo.muted=true;
const canvas=document.createElement("canvas"); const ctx=canvas.getContext("2d");
function showPreview(e){
  const percent=scrubTo(e); const time=percent*video.duration; hiddenVideo.currentTime=time;
  canvas.width=160; canvas.height=90; ctx.drawImage(hiddenVideo,0,0,canvas.width,canvas.height);
  previewImage.src=canvas.toDataURL(); previewTime.textContent=formatTime(time);
  previewBox.style.display="block"; previewBox.style.left=(e.clientX-120)+"px";
}
function hidePreview(){ previewBox.style.display="none"; }

// ======================= SUBTITLES =======================
function updateSubtitle(){ subtitleOverlay.textContent=subtitlesEnabled?video.textTracks[0]?.activeCues[0]?.text||"":""; }
video.textTracks[0]?.addEventListener("cuechange",updateSubtitle);

// ======================= UI HIDE =======================
function showUI(){ ui.classList.remove("hidden"); clearTimeout(hideTimeout); hideTimeout=setTimeout(()=>ui.classList.add("hidden"),4000); }
document.addEventListener("mousemove",showUI);
ui.addEventListener("mouseenter",()=>clearTimeout(hideTimeout));
ui.addEventListener("mouseleave",()=>hideTimeout=setTimeout(()=>ui.classList.add("hidden"),2000));

// ======================= FULLSCREEN =======================
document.getElementById("fullscreenBtn").addEventListener("click",()=>{if(!document.fullscreenElement){container.requestFullscreen()}else{document.exitFullscreen()}});

// ======================= CAPTIONS MENU =======================
document.getElementById("captionsBtn").addEventListener("click",()=>{captionMenu.style.display=captionMenu.style.display==="block"?"none":"block";});
function populateTracks(){
  video.audioTracks?.forEach((track,i)=>{const btn=document.createElement("button"); btn.textContent=track.label; btn.onclick=()=>track.enabled=true; audioTracksDiv.appendChild(btn);});
  video.textTracks?.forEach((track,i)=>{const btn=document.createElement("button"); btn.textContent=track.label; btn.onclick=()=>{track.mode=track.mode==="showing"?"hidden":"showing";}; subtitleTracksDiv.appendChild(btn);});
}
video.addEventListener("loadedmetadata",populateTracks);

// ======================= RESUME =======================
const filmId="film1"; const lastProgress=localStorage.getItem("progress_"+filmId);
if(lastProgress>0&&lastProgress<100){ resumeOverlay.style.display="flex"; }
continueBtn.addEventListener("click",()=>{video.currentTime=(lastProgress/100)*video.duration; resumeOverlay.style.display="none"; video.play(); });
restartBtn.addEventListener("click",()=>{resumeOverlay.style.display="none"; video.currentTime=0; video.play(); });

</script>
</body>
</html>


















